# **æŠ€æœ¯æ–¹æ¡ˆ V4.0ï¼šåŒæµAIä»£ç è¯„å®¡å¼•æ“ (å®Œæ•´ç‰ˆ)**

---

## ğŸ¯ **1. æ ¸å¿ƒæ„¿æ™¯ä¸ç›®æ ‡**

æœ¬æ’ä»¶æ—¨åœ¨æˆä¸ºä¸€ä¸ª**AIé©±åŠ¨çš„ã€å…·å¤‡è¾©è¯åˆ†æèƒ½åŠ›çš„â€œä»£ç è¯„å®¡ä¸“å®¶â€**ã€‚å®ƒä¸ä»…ç†è§£ä»£ç çš„è¡¨å±‚é€»è¾‘ï¼Œæ›´èƒ½æ´å¯Ÿå…¶èƒŒåçš„**ä¸šåŠ¡æ„å›¾**ä¸æ½œåœ¨çš„**æŠ€æœ¯é£é™©**ï¼Œä¸ºå¼€å‘å›¢é˜Ÿæä¾›æ·±åº¦ã€ä¸“ä¸šä¸”è‡ªåŠ¨åŒ–çš„ä»£ç è¯„å®¡æœåŠ¡ã€‚

æ ¸å¿ƒç›®æ ‡æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªèµ„æ·±æ¶æ„å¸ˆçš„è¯„å®¡è¿‡ç¨‹ï¼Œå¯¹ä¸€ä¸ªå®Œæ•´çš„Merge Request (MR)æˆ–ç‰¹æ€§åˆ†æ”¯è¿›è¡Œå…¨é¢åˆ†æï¼Œå¹¶å›ç­”ï¼š

1.  **åŠŸ (Merit)**: è¿™æ¬¡å˜æ›´å®ç°äº†ä»€ä¹ˆæœ‰ä»·å€¼çš„åŠŸèƒ½ï¼Ÿ(æ„å›¾åˆ†æ)
2.  **è¿‡ (Flaw)**: è¿™æ¬¡å˜æ›´å¼•å…¥äº†å“ªäº›æŠ€æœ¯é£é™©æˆ–åå‘³é“ï¼Ÿ(å½±å“åˆ†æ)
3.  **ç­– (Suggestion)**: å¦‚ä½•åœ¨ä¿ç•™å…¶åŠŸèƒ½ä»·å€¼çš„åŒæ—¶ï¼Œä¿®å¤å…¶æŠ€æœ¯ç¼ºé™·ï¼Ÿ(ç»¼åˆå»ºè®®)

## âš™ï¸ **2. æ ¸å¿ƒç”¨æˆ·å·¥ä½œæµ**

1.  **è§¦å‘**: å¼€å‘è€…åœ¨IDEä¸­é€šè¿‡å³é”®èœå•æˆ–å·¥å…·æ æŒ‰é’®ä¸»åŠ¨è§¦å‘åˆ†æï¼Œé€‰æ‹©è¦å¯¹æ¯”çš„**æºåˆ†æ”¯** (e.g., `feature/xxx`) å’Œ**ç›®æ ‡åˆ†æ”¯** (e.g., `main`)ã€‚
2.  **é¢„å¤„ç†ä¸åŠ æƒ**: æ’ä»¶åœ¨åå°å¯åŠ¨**â€œåŒæµåˆ†æå¼•æ“â€**ï¼Œå¯¹ä¸¤ä¸ªåˆ†æ”¯é—´çš„ä»£ç å·®å¼‚è¿›è¡Œæ‰«æï¼Œå¹¶ä»**â€œæ„å›¾â€**å’Œ**â€œé£é™©â€**ä¸¤ä¸ªç»´åº¦ï¼Œå¯¹æ‰€æœ‰ç›¸å…³çš„è°ƒç”¨é“¾è·¯å’Œä»£ç å˜æ›´è¿›è¡ŒåŠ æƒè¯„åˆ†ã€‚
3.  **ä¸¤é˜¶æ®µAIåˆ†æ**: 
    *   **é˜¶æ®µä¸€ (å¿«é€Ÿç­›é€‰)**: ä½¿ç”¨è½»é‡çº§ã€é«˜é€Ÿåº¦çš„AIæ¨¡å‹ï¼Œæ ¹æ®é¢„å¤„ç†é˜¶æ®µçš„æƒé‡ï¼Œç­›é€‰å‡ºâ€œé»„é‡‘é“¾è·¯â€å’Œâ€œé«˜å±é“¾è·¯â€ã€‚
    *   **é˜¶æ®µäºŒ (æ·±åº¦ç ”åˆ¤)**: å°†ç­›é€‰å‡ºçš„ã€å¸¦æœ‰æ˜ç¡®ä¸Šä¸‹æ–‡ï¼ˆæ„å›¾/é£é™©ï¼‰çš„å…³é”®ä¿¡æ¯ï¼Œæäº¤ç»™å¼ºå¤§çš„ä¸»åˆ†æAIæ¨¡å‹ï¼Œè¿›è¡Œæ·±åº¦ã€è¾©è¯çš„åˆ†æã€‚
4.  **æŠ¥å‘Šå‘ˆç°**: åœ¨IDEçš„ä¸“å±å·¥å…·çª—å£ä¸­ï¼Œå±•ç¤ºä¸€ä»½ç»“æ„åŒ–ã€å±‚æ¬¡åˆ†æ˜çš„**â€œAIä»£ç è¯„å®¡æŠ¥å‘Šâ€**ï¼Œæ¸…æ™°åœ°åˆ—å‡ºå¯¹æ„å›¾ã€é£é™©çš„åˆ†æä»¥åŠæœ€ç»ˆçš„ç»¼åˆå»ºè®®ã€‚

## ğŸ—ï¸ **3. ç³»ç»Ÿæ¶æ„è®¾è®¡ (V4.0)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            IntelliJ IDEA Plugin                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å±•ç°å±‚ (UI Layer)                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   åˆ†æ”¯é€‰æ‹©å¯¹è¯æ¡†         â”‚   â”‚        AIä»£ç è¯„å®¡æŠ¥å‘Š (Tool Window)     â”‚ â”‚
â”‚  â”‚   - æº/ç›®æ ‡åˆ†æ”¯          â”‚   â”‚        - Part 1: æ„å›¾åˆ†æ             â”‚ â”‚
â”‚  â”‚   - è§¦å‘åˆ†ææŒ‰é’®         â”‚   â”‚        - Part 2: é£é™©åˆ†æ             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚        - Part 3: ç»¼åˆè¯„å®¡             â”‚ â”‚
â”‚                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é€»è¾‘å±‚ (Core Layer) - åŒæµæ™ºèƒ½åˆ†æå¼•æ“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                     æ™ºèƒ½é¢„å¤„ç†å™¨ (åŒæƒé‡ç³»ç»Ÿ)                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â”‚   æµA: æ„å›¾æƒé‡è®¡ç®—å™¨       â”‚  â”‚   æµB: é£é™©æƒé‡è®¡ç®—å™¨          â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                     ä¸¤é˜¶æ®µå¤§æ¨¡å‹è°ƒç”¨ç®¡ç†å™¨                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â”‚   é˜¶æ®µä¸€: é¢„åˆ†æ (å°æ¨¡å‹)   â”‚  â”‚   é˜¶æ®µäºŒ: æ·±åº¦åˆ†æ (å¤§æ¨¡å‹)    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   ä¸Šä¸‹æ–‡èšåˆå™¨           â”‚   â”‚   PSIè§£æå¼•æ“   â”‚  â”‚  åµŒå…¥å¼å›¾å¼•æ“   â”‚  â”‚
â”‚  â”‚   - Git Diff/Log         â”‚   â”‚   - ASTéå†     â”‚  â”‚   - JGraphT     â”‚  â”‚
â”‚  â”‚   - æµ‹è¯•ç”¨ä¾‹å…³è”         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   - å†…å­˜å›¾æ¨¡å‹  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°æ®å±‚ (Data Layer) - æ— å¤–éƒ¨ä¾èµ–                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  å›¾æ•°æ®ç£ç›˜ç¼“å­˜  â”‚  â”‚   ç´¢å¼•çŠ¶æ€       â”‚  â”‚    æ’ä»¶é…ç½® (Settings)   â”‚  â”‚
â”‚  â”‚  - project.graphâ”‚  â”‚   - isIndexed    â”‚  â”‚    - LLM Api Keys      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ’¾ **4. æ•°æ®æ¨¡å‹ä¸å›¾å¼•æ“è®¾è®¡**

æˆ‘ä»¬å°†ä½¿ç”¨**åµŒå…¥å¼å›¾å¼•æ“ (JGraphT)**ï¼Œé¿å…ä»»ä½•å¤–éƒ¨ä¾èµ–ï¼Œä½†å…¶å†…éƒ¨çš„æ•°æ®ç»“æ„å°†éµå¾ªä»¥ä¸‹ç»è¿‡æ·±æ€ç†Ÿè™‘çš„ã€æ¸…æ™°çš„è§„èŒƒã€‚

### **4.1 èŠ‚ç‚¹IDè§„èŒƒ**
- **æ–¹æ³•èŠ‚ç‚¹ID**: `{packageName}.{className}#{methodName}({paramTypes})`
  - *ç¤ºä¾‹*: `com.example.service.UserService#getUser(java.lang.String)`
- **ç±»èŠ‚ç‚¹ID**: `{packageName}.{className}`
  - *ç¤ºä¾‹*: `com.example.service.UserService`

### **4.2 æ ¸å¿ƒæ•°æ®æ¨¡å‹ (æ¦‚å¿µæ€§)**

#### **èŠ‚ç‚¹ç±»å‹ (Node)**
```java
// æ¦‚å¿µæ¨¡å‹: æ–¹æ³•èŠ‚ç‚¹
MethodNode {
    String id; // å”¯ä¸€æ ‡è¯†
    String methodName;
    String signature; // å®Œæ•´æ–¹æ³•ç­¾å
    String returnType;
    List<String> paramTypes;
    String blockType; // CONTROLLER, SERVICE, MAPPER, etc.
    boolean isInterface;
    List<String> annotations;
    String filePath; // ç»å¯¹è·¯å¾„
    int lineNumber;
}

// æ¦‚å¿µæ¨¡å‹: ç±»èŠ‚ç‚¹
ClassNode {
    String id; // å”¯ä¸€æ ‡è¯†
    String className;
    String packageName;
    String blockType;
    boolean isInterface;
    String filePath;
}
```

#### **å…³ç³»ç±»å‹ (Edge)**
```java
// æ¦‚å¿µæ¨¡å‹: è°ƒç”¨å…³ç³»
CallsEdge {
    MethodNode caller;
    MethodNode callee;
    String callType; // DIRECT, INTERFACE, REFLECTION
    int lineNumber; // è°ƒç”¨å‘ç”Ÿè¡Œå·
}

// æ¦‚å¿µæ¨¡å‹: å®ç°å…³ç³»
ImplementsEdge {
    MethodNode interfaceMethod;
    MethodNode implementationMethod;
}
```

### **4.3 åµŒå…¥å¼å›¾å¼•æ“å·¥ä½œæµ**
1.  **é¦–æ¬¡ç´¢å¼•**: æ’ä»¶é¦–æ¬¡å¯¹é¡¹ç›®è¿›è¡Œå…¨é‡æ‰«æï¼Œä½¿ç”¨PSIè§£æå™¨æ„å»ºä¸€ä¸ªå®Œæ•´çš„è°ƒç”¨å…³ç³»å›¾ï¼Œå­˜å‚¨åœ¨å†…å­˜çš„`JGraphT`å¯¹è±¡ä¸­ã€‚
2.  **æŒä¹…åŒ–**: å°†æ„å»ºå¥½çš„å›¾æ¨¡å‹åºåˆ—åŒ–æˆä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¦‚ `project.graph`ï¼‰ï¼Œå­˜å‚¨åœ¨é¡¹ç›®çš„`.idea`æˆ–`.autocr`ç›®å½•ä¸‹ï¼Œé¿å…æ¯æ¬¡é‡å¯IDEéƒ½é‡æ–°å…¨é‡ç´¢å¼•ã€‚
3.  **å¢é‡æ›´æ–°**: ï¼ˆå¯¹äºå®æ—¶åˆ†æåœºæ™¯ï¼‰ç›‘å¬æ–‡ä»¶å˜æ›´ï¼Œä»…é‡æ–°è§£æè¯¥æ–‡ä»¶å¹¶æ›´æ–°å†…å­˜å›¾æ¨¡å‹ã€‚å¯¹äºMRåˆ†æåœºæ™¯ï¼Œæ­¤æ­¥éª¤å¯å¿½ç•¥ã€‚

## ğŸ”§ **5. æ ¸å¿ƒé€»è¾‘ä¸ç®—æ³•æ·±æ½œ**

### **5.1 PSIè§£æä¸èŒƒå›´é™å®š**

ä¸ºæé«˜æ•ˆç‡å’Œå‡†ç¡®æ€§ï¼Œæˆ‘ä»¬åªç´¢å¼•æˆ‘ä»¬å…³å¿ƒçš„ä»£ç ã€‚

#### **ç›®æ ‡ç±»å‹è¯†åˆ« (æ³¨è§£ä¼˜å…ˆ)**
æˆ‘ä»¬å°†ä¼˜å…ˆé€šè¿‡æ£€æŸ¥ç±»æ˜¯å¦åŒ…å«å…³é”®æ³¨è§£ï¼ˆå¦‚`@RestController`, `@Service`, `@Repository`ï¼‰æ¥è¯†åˆ«å…¶`blockType`ã€‚å½“æ³¨è§£ä¸å­˜åœ¨æ—¶ï¼Œæ‰å¯ç”¨å¤‡ç”¨çš„ã€åŸºäºç±»ååç¼€çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚

```kotlin
// ç¤ºä¾‹: èŒƒå›´é™å®šç­–ç•¥
object ClassTypeDetector {
    // ä¼˜å…ˆä½¿ç”¨æ³¨è§£åˆ¤æ–­
    fun detectBlockType(psiClass: PsiClass): BlockType? {
        if (psiClass.hasAnnotation("org.springframework.stereotype.Service")) return BlockType.SERVICE
        if (psiClass.hasAnnotation("org.springframework.web.bind.annotation.RestController")) return BlockType.CONTROLLER
        // ... å…¶ä»–æ³¨è§£
        
        // æ³¨è§£ä¸å­˜åœ¨æ—¶ï¼Œä½¿ç”¨å¤‡ç”¨æ­£åˆ™
        return detectByClassName(psiClass.name ?: "")
    }
    
    private fun detectByClassName(className: String): BlockType? {
        // ... V2ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼é€»è¾‘ ...
    }
}
```

### **5.2 ä¸Šä¸‹æ–‡èšåˆå™¨**
æ­¤æ¨¡å—è´Ÿè´£ä¸ºAIå‡†å¤‡å…¨é¢ã€é«˜è´¨é‡çš„â€œæ¡ˆå‘ç°åœºâ€ä¿¡æ¯ã€‚
1.  **Gitå·®å¼‚åˆ†æå™¨**: æ‰§è¡Œ `git diff --name-status <target_branch>..<source_branch>` è·å–æ‰€æœ‰å˜æ›´æ–‡ä»¶åˆ—è¡¨ã€‚å¯¹æ¯ä¸ªæ–‡ä»¶æ‰§è¡Œ`git diff`è·å–å…·ä½“ä»£ç å˜æ›´ã€‚
2.  **Gitæ—¥å¿—æå–å™¨**: æ‰§è¡Œ `git log <target_branch>..<source_branch` è·å–è¯¥åˆ†æ”¯ä¸Šçš„æ‰€æœ‰Commit Messageï¼Œäº†è§£å¼€å‘è€…â€œå£°ç§°çš„æ„å›¾â€æ¼”è¿›è¿‡ç¨‹ã€‚
3.  **æµ‹è¯•ç”¨ä¾‹å…³è”å™¨**: æ ¹æ®å˜æ›´çš„ä¸šåŠ¡ä»£ç è·¯å¾„ï¼ˆå¦‚`src/main`ï¼‰ï¼Œæ™ºèƒ½æŸ¥æ‰¾å¹¶åˆ†æå¯¹åº”æµ‹è¯•è·¯å¾„ï¼ˆ`src/test`ï¼‰ä¸‹çš„æ–‡ä»¶å˜æ›´ã€‚
4.  **å®Œæ•´æ–¹æ³•ä½“æå–å™¨**: å¯¹äºå‘ç”Ÿå˜æ›´çš„æ–¹æ³•ï¼Œä½¿ç”¨PSIæå–å…¶**ä¿®æ”¹å‰**å’Œ**ä¿®æ”¹å**çš„å®Œæ•´æ–¹æ³•ä½“ä»£ç ï¼Œæä¾›æ›´å®Œæ•´çš„é€»è¾‘ä¸Šä¸‹æ–‡ã€‚

### **5.3 åŒæµæ™ºèƒ½é¢„å¤„ç†å™¨ (æ ¸å¿ƒåˆ›æ–°)**
æ­¤æ¨¡å—æ˜¯åˆ†æè´¨é‡çš„å…³é”®ï¼Œå®ƒå¹¶è¡Œè®¡ç®—ä¸¤ç§æƒé‡ï¼Œä»¥ç­›é€‰ä¿¡æ¯ã€‚

#### **æµ A: æ„å›¾æƒé‡ (Intent Weight)**
*   **ç›®æ ‡**: è¯†åˆ«æœ€èƒ½ä»£è¡¨â€œå¼€å‘è€…æƒ³åšä»€ä¹ˆâ€çš„**é»„é‡‘é“¾è·¯ (Golden Path)**ã€‚
*   **é«˜æƒé‡ä¿¡å·**:
    *   **æ–°ç«¯ç‚¹é“¾è·¯**: ä»æ–°çš„`@PostMapping`æˆ–`@GetMapping`å‡ºå‘ï¼Œè´¯ç©¿`Service`ï¼Œæœ€ç»ˆåˆ°è¾¾`Repository/Mapper`çš„å®Œæ•´é“¾è·¯ã€‚
    *   **ä¸šåŠ¡åè¯åŒ¹é…**: é“¾è·¯ä¸­çš„ç±»/æ–¹æ³•åä¸Commit Messageä¸­çš„æ ¸å¿ƒåè¯ï¼ˆå¦‚`User`, `Score`ï¼‰é«˜åº¦ç›¸å…³ã€‚
    *   **DTO/VOå˜æ›´**: é“¾è·¯ä¸­æ¶‰åŠæ•°æ®ä¼ è¾“å¯¹è±¡çš„å­—æ®µå˜æ›´ã€‚

#### **æµ B: é£é™©æƒé‡ (Risk Weight)**
*   **ç›®æ ‡**: è¯†åˆ«æœ€å¯èƒ½â€œå¼•å…¥é—®é¢˜â€çš„**é«˜å±é“¾è·¯ (High-Risk Path)**ã€‚
*   **é«˜æƒé‡ä¿¡å·**:
    *   **æ¶æ„è¿è§„**: è·¨å±‚è°ƒç”¨ (`Controller` -> `DAO`)ã€‚
    *   **é«˜çˆ†ç‚¸åŠå¾„**: ä¿®æ”¹äº†ä¸€ä¸ªè¢«é¡¹ç›®å¤§é‡å¤ç”¨çš„å…¬å…±æ–¹æ³•æˆ–å·¥å…·ç±»ã€‚
    *   **æ•æ„Ÿæ³¨è§£**: é“¾è·¯ä¸­æ¶‰åŠ `@Transactional`, `@Async`, `@Scheduled`, `@Lock` ç­‰ã€‚
    *   **ç¼ºä¹æµ‹è¯•**: è¢«ä¿®æ”¹çš„æ ¸å¿ƒé€»è¾‘æ²¡æœ‰å¯¹åº”çš„å•å…ƒæµ‹è¯•å˜æ›´ã€‚
    *   **â€œè·¨é¢†åŸŸâ€ä¿®æ”¹**: ä¸€æ¬¡æäº¤ä¸­ä¿®æ”¹äº†å¤šä¸ªåŠŸèƒ½ä¸Šä¸ç›¸å…³çš„æ¨¡å—ã€‚

### **5.4 ä¸¤é˜¶æ®µå¤§æ¨¡å‹è°ƒç”¨**
1.  **é˜¶æ®µä¸€ (é¢„åˆ†æ - è½»é‡çº§æ¨¡å‹)**: å°†æ‰€æœ‰é“¾è·¯å’Œdiffä¿¡æ¯äº¤ç»™å°æ¨¡å‹ï¼Œè®©å…¶æ‰§è¡Œæƒé‡è®¡ç®—ï¼Œè¾“å‡º`Top 1-2 Intent Paths`å’Œ`Top 3-5 Risk Paths`åŠå…¶ç†ç”±ã€‚
2.  **é˜¶æ®µäºŒ (æ·±åº¦åˆ†æ - ä¸»åŠ›æ¨¡å‹)**: å°†ç¬¬ä¸€é˜¶æ®µç­›é€‰å‡ºçš„ã€å¸¦æœ‰æ˜ç¡®ä¸Šä¸‹æ–‡çš„é«˜ä»·å€¼ä¿¡æ¯ï¼Œæäº¤ç»™å¼ºå¤§çš„ä¸»åŠ›æ¨¡å‹ï¼Œå¹¶ä½¿ç”¨ä¸‹é¢çš„ç»ˆæPromptæ¨¡æ¿ã€‚

### **5.5 ç»ˆæPromptæ¨¡æ¿ (V4.0)**
```text
# Role: Senior Software Architect

You are conducting a comprehensive code review for a Merge Request. Your task is to first analyze the developer's intended functionality and its implementation, and then separately analyze the potential risks and negative impacts. Finally, provide a balanced, holistic review.

# ==========================================
# Part 1: Intent Analysis (The "What")
# ==========================================

# Context for Intent Analysis:
The following "Golden Path" is believed to represent the core feature being implemented. The associated code changes and commit messages are also provided.

- **Golden Path**: ${top_intent_path}
- **Related Code Changes**: ${intent_related_diffs}
- **Developer's Stated Intent (Commit Msg)**: "${commit_messages}"

# Your Task for Part 1:
Based ONLY on the information for Intent Analysis, please answer:
1.  **Functionality Implemented**: Describe the business feature or technical functionality the developer has added or changed.
2.  **Implementation Summary**: Briefly explain how this functionality was technically realized through the provided code path.

# ==========================================
# Part 2: Impact & Risk Analysis (The "How")
# ==========================================

# Context for Risk Analysis:
The following "High-Risk Paths" have been identified by a pre-analysis tool due to potential issues.

<for each risk_path>
- **Risk Path**: ${risk_path}
- **Identified Risk**: ${reason_for_high_risk_weight}
- **Related Code Changes**: ${risk_related_diffs}
</for>

# Your Task for Part 2:
Based ONLY on the risk-related information, please answer:
1.  **Potential Bugs**: Identify any specific potential bugs or logical errors.
2.  **Architectural Concerns**: Point out any violations of software architecture principles.
3.  **Maintenance Issues**: Highlight any changes that might make the code harder to maintain.

# ==========================================
# Part 3: Holistic Review & Final Verdict
# ==========================================

# Your Task for Part 3:
Now, considering your analysis from both Part 1 and Part 2, provide a final, balanced code review.

### Overall Summary:
(Acknowledge the value of the implemented feature.)

### Actionable Recommendations:
(Provide a prioritized list of concrete suggestions, linking each back to a risk from Part 2.)
- **[High Priority]**: ...
- **[Medium Priority]**: ...
- **[Low Priority/Suggestion]**: ...

### Final Approval:
(Conclude with a final recommendation: "Approved with required changes," "Requires major rework," or "Looks good to merge.")
```

## ğŸ“ˆ **6. æˆåŠŸæŒ‡æ ‡**

### **æ€§èƒ½æŒ‡æ ‡**
- **åˆ†æé€Ÿåº¦**: ä¸­å‹é¡¹ç›® (100k LoC, 50 files changed) çš„å®Œæ•´MRåˆ†æ < 90ç§’ã€‚
- **å†…å­˜å ç”¨**: æ’ä»¶ç´¢å¼•å’Œåˆ†ææœŸé—´çš„å³°å€¼å†…å­˜å ç”¨ < 1GBã€‚
- **å‡†ç¡®ç‡**: å…³é”®é“¾è·¯ï¼ˆæ„å›¾/é£é™©ï¼‰è¯†åˆ«å‡†ç¡®ç‡ > 90%ã€‚

### **ç”¨æˆ·ä½“éªŒæŒ‡æ ‡**
- **æ˜“ç”¨æ€§**: ä»è§¦å‘åˆ°çœ‹åˆ°æŠ¥å‘Šï¼Œæ“ä½œæ­¥éª¤ < 3æ­¥ã€‚
- **æŠ¥å‘Šè´¨é‡**: AIç”Ÿæˆçš„è¯„å®¡æ„è§è¢«å¼€å‘è€…é‡‡çº³ç‡ > 70%ã€‚
- **é”™è¯¯ç‡**: æ’ä»¶è¿è¡Œæ—¶å´©æºƒç‡ < 0.1%ã€‚

## ğŸ—ºï¸ **7. å®æ–½è·¯çº¿å›¾**

1.  **é˜¶æ®µä¸€ï¼šåŸºç¡€å¼•æ“æ­å»º**: å®ç°`åµŒå…¥å¼å›¾å¼•æ“`å’Œ`ä¸Šä¸‹æ–‡èšåˆå™¨`ã€‚
2.  **é˜¶æ®µäºŒï¼šåŒæµé¢„å¤„ç†å™¨**: å¼€å‘`æ™ºèƒ½é¢„å¤„ç†å™¨`ï¼Œå®ç°åŒæƒé‡è®¡ç®—ç®—æ³•ã€‚
3.  **é˜¶æ®µä¸‰ï¼šAIé›†æˆä¸å‘ˆç°**: å®ç°`ä¸¤é˜¶æ®µå¤§æ¨¡å‹è°ƒç”¨ç®¡ç†å™¨`å’ŒUIç•Œé¢ã€‚
4.  **é˜¶æ®µå››ï¼šé«˜çº§åŠŸèƒ½ä¸ä¼˜åŒ–**: é›†æˆCI/CDæµç¨‹ï¼Œæ”¯æŒGitHub/GitLab APIï¼Œæä¾›é…ç½®ç•Œé¢å…è®¸ç”¨æˆ·å¾®è°ƒæƒé‡è§„åˆ™ã€‚
