# Javaé¡¹ç›®è°ƒç”¨é“¾è·¯åˆ†ææ’ä»¶ - ä¼˜åŒ–æŠ€æœ¯æ–¹æ¡ˆ V2.0

## ğŸ¯ æ ¸å¿ƒéœ€æ±‚é‡æ–°å®šä¹‰

### çœŸå®ä½¿ç”¨åœºæ™¯
å½“å¼€å‘è€…ä¿®æ”¹äº†é¡¹ç›®ä¸­çš„2-3ä¸ªåœ°æ–¹æ—¶ï¼Œæ’ä»¶èƒ½å¤Ÿï¼š
1. **è‡ªåŠ¨è¯†åˆ«**ä¿®æ”¹æ¶‰åŠçš„æ–¹æ³•èŠ‚ç‚¹
2. **æ™ºèƒ½åˆ†æ**è¿™äº›èŠ‚ç‚¹ä¹‹é—´çš„è°ƒç”¨å…³ç³»
3. **æ¨èå‰3æ¡**æœ€å¯èƒ½çš„è°ƒç”¨è·¯å¾„
4. **å¯è§†åŒ–å±•ç¤º**å®Œæ•´çš„è°ƒç”¨é“¾è·¯

### æ ¸å¿ƒä»·å€¼
- **å½±å“åˆ†æ**: å¿«é€Ÿäº†è§£ä»£ç ä¿®æ”¹çš„å½±å“èŒƒå›´
- **è·¯å¾„å‘ç°**: è‡ªåŠ¨å‘ç°ä¿®æ”¹ç‚¹ä¹‹é—´çš„ä¸šåŠ¡é€»è¾‘å…³è”
- **é£é™©è¯„ä¼°**: è¯†åˆ«æ½œåœ¨çš„è°ƒç”¨é“¾è·¯é£é™©

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡ V2.0

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    IntelliJ IDEA Plugin                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å±•ç°å±‚ (UI Layer)                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   ç´¢å¼•çŠ¶æ€é¢æ¿   â”‚  â”‚   è·¯å¾„åˆ†æé¢æ¿   â”‚  â”‚  è°ƒç”¨å›¾è°±é¢æ¿ â”‚ â”‚
â”‚  â”‚   - ç´¢å¼•è¿›åº¦     â”‚  â”‚   - å˜æ›´æ£€æµ‹     â”‚  â”‚  - èŠ‚ç‚¹å…³ç³»   â”‚ â”‚
â”‚  â”‚   - ç»Ÿè®¡ä¿¡æ¯     â”‚  â”‚   - è·¯å¾„æ¨è     â”‚  â”‚  - å¯è§†åŒ–å›¾   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é€»è¾‘å±‚ (Core Layer)                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  èŒƒå›´é™å®šè§£æå™¨  â”‚  â”‚   å˜æ›´æ£€æµ‹å™¨     â”‚  â”‚  è·¯å¾„æ¨èå™¨   â”‚ â”‚
â”‚  â”‚  - Controller   â”‚  â”‚   - æ–‡ä»¶ç›‘å¬     â”‚  â”‚  - è·¯å¾„ç®—æ³•   â”‚ â”‚
â”‚  â”‚  - Service      â”‚  â”‚   - æ–¹æ³•è¯†åˆ«     â”‚  â”‚  - æƒé‡è®¡ç®—   â”‚ â”‚
â”‚  â”‚  - Mapper/DAO   â”‚  â”‚   - èŠ‚ç‚¹å®šä½     â”‚  â”‚  - æ’åºæ¨è   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   PSIè§£æå¼•æ“   â”‚  â”‚   å…³ç³»æ„å»ºå™¨     â”‚  â”‚  ç¼“å­˜ç®¡ç†å™¨   â”‚ â”‚
â”‚  â”‚  - æ–¹æ³•è§£æ     â”‚  â”‚   - è°ƒç”¨å…³ç³»     â”‚  â”‚  - å†…å­˜ç¼“å­˜   â”‚ â”‚
â”‚  â”‚  - æ¥å£å®ç°     â”‚  â”‚   - å®ç°å…³ç³»     â”‚  â”‚  - ç£ç›˜ç¼“å­˜   â”‚ â”‚
â”‚  â”‚  - æ³¨è§£è¯†åˆ«     â”‚  â”‚   - ç»§æ‰¿å…³ç³»     â”‚  â”‚  - å¢é‡æ›´æ–°   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°æ®å±‚ (Data Layer)                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     Neo4j       â”‚  â”‚   æœ¬åœ°ç¼“å­˜       â”‚  â”‚   é…ç½®å­˜å‚¨    â”‚ â”‚
â”‚  â”‚  - èŠ‚ç‚¹å­˜å‚¨     â”‚  â”‚   - çƒ­ç‚¹æ•°æ®     â”‚  â”‚  - è¿æ¥é…ç½®   â”‚ â”‚
â”‚  â”‚  - å…³ç³»å­˜å‚¨     â”‚  â”‚   - æŸ¥è¯¢ç¼“å­˜     â”‚  â”‚  - ç´¢å¼•é…ç½®   â”‚ â”‚
â”‚  â”‚  - è·¯å¾„æŸ¥è¯¢     â”‚  â”‚   - ç»“æœç¼“å­˜     â”‚  â”‚  - ç”¨æˆ·è®¾ç½®   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š æ•°æ®æ¨¡å‹è®¾è®¡

### èŠ‚ç‚¹æ ‡è¯†è§„èŒƒ
```
æ–¹æ³•èŠ‚ç‚¹IDæ ¼å¼: {packageName}.{className}#{methodName}
ç¤ºä¾‹: com.shuwei.boot.erp.service.ErpAccountService#getByOpenId

å®ç°ç±»èŠ‚ç‚¹IDæ ¼å¼: {packageName}.{implClassName}#{methodName}  
ç¤ºä¾‹: com.shuwei.boot.erp.service.impl.ErpAccountServiceImpl#getByOpenId
```

### Neo4j æ•°æ®æ¨¡å‹

#### èŠ‚ç‚¹ç±»å‹ (Node Labels)
```cypher
// æ–¹æ³•èŠ‚ç‚¹ - æ ¸å¿ƒèŠ‚ç‚¹ç±»å‹
(:Method {
    id: "com.shuwei.boot.erp.service.ErpAccountService#getByOpenId",
    className: "com.shuwei.boot.erp.service.ErpAccountService",
    methodName: "getByOpenId", 
    signature: "getByOpenId(String openId)",
    returnType: "ErpAccount",
    paramTypes: ["String"],
    blockType: "SERVICE", // CONTROLLER, SERVICE, MAPPER, DAO, MANAGER, HANDLER
    isInterface: true,
    isPublic: true,
    annotations: ["@Override", "@Transactional"],
    filePath: "/src/main/java/com/shuwei/boot/erp/service/ErpAccountService.java",
    lineNumber: 25,
    lastModified: 1703123456789
})

// ç±»èŠ‚ç‚¹ - ç”¨äºç»„ç»‡å’ŒæŸ¥è¯¢
(:Class {
    id: "com.shuwei.boot.erp.service.ErpAccountService",
    className: "ErpAccountService", 
    packageName: "com.shuwei.boot.erp.service",
    blockType: "SERVICE",
    isInterface: true,
    filePath: "/src/main/java/com/shuwei/boot/erp/service/ErpAccountService.java"
})
```

#### å…³ç³»ç±»å‹ (Relationships)
```cypher
// 1. è°ƒç”¨å…³ç³» - æ ¸å¿ƒå…³ç³»
(caller:Method)-[:CALLS {
    callType: "DIRECT",        // DIRECT, INTERFACE, REFLECTION, ANNOTATION
    confidence: 0.95,          // è°ƒç”¨ç¡®å®šæ€§ 0.0-1.0
    lineNumber: 45,            // è°ƒç”¨å‘ç”Ÿçš„è¡Œå·
    frequency: 1,              // é™æ€åˆ†æä¸­é€šå¸¸ä¸º1
    lastAnalyzed: 1703123456789
}]->(callee:Method)

// 2. å®ç°å…³ç³» - æ¥å£ä¸å®ç°ç±»
(interface:Method)-[:IMPLEMENTS {
    implType: "DIRECT",        // DIRECT, INHERITED, PROXY
    confidence: 1.0
}]->(implementation:Method)

// 3. ç»§æ‰¿å…³ç³» - ç±»ç»§æ‰¿
(parent:Method)-[:INHERITS]->(child:Method)

// 4. åŒ…å«å…³ç³» - ç±»ä¸æ–¹æ³•
(class:Class)-[:CONTAINS]->(method:Method)

// 5. ä¾èµ–å…³ç³» - ç±»ä¹‹é—´çš„ä¾èµ–
(dependent:Class)-[:DEPENDS_ON {
    dependencyType: "INJECTION", // INJECTION, IMPORT, INHERITANCE
    strength: 0.8
}]->(dependency:Class)
```

---

## ğŸ” èŒƒå›´é™å®šç­–ç•¥

### ç›®æ ‡ç±»å‹è¯†åˆ«è§„åˆ™
```kotlin
object ClassTypeDetector {
    private val CONTROLLER_PATTERNS = listOf(
        ".*Controller$",
        ".*RestController$", 
        ".*WebController$"
    )
    
    private val SERVICE_PATTERNS = listOf(
        ".*Service$",
        ".*ServiceImpl$",
        ".*Manager$", 
        ".*ManagerImpl$"
    )
    
    private val MAPPER_PATTERNS = listOf(
        ".*Mapper$",
        ".*DAO$", 
        ".*Repository$",
        ".*Handler$"
    )
    
    fun detectBlockType(className: String): BlockType? {
        return when {
            CONTROLLER_PATTERNS.any { className.matches(it.toRegex()) } -> BlockType.CONTROLLER
            SERVICE_PATTERNS.any { className.matches(it.toRegex()) } -> BlockType.SERVICE  
            MAPPER_PATTERNS.any { className.matches(it.toRegex()) } -> BlockType.MAPPER
            else -> null // å¿½ç•¥å…¶ä»–ç±»å‹
        }
    }
}

enum class BlockType {
    CONTROLLER, SERVICE, MANAGER, MAPPER, DAO, HANDLER
}
```

### ç´¢å¼•èŒƒå›´æ§åˆ¶
```kotlin
class ScopedIndexer {
    // åªç´¢å¼•æŒ‡å®šåŒ…è·¯å¾„ä¸‹çš„ç›®æ ‡ç±»å‹
    fun shouldIndex(psiClass: PsiClass): Boolean {
        val className = psiClass.name ?: return false
        val packageName = getPackageName(psiClass)
        
        return ClassTypeDetector.detectBlockType(className) != null &&
               isInTargetPackage(packageName) &&
               !isTestClass(psiClass)
    }
    
    private fun isInTargetPackage(packageName: String): Boolean {
        // åªç´¢å¼•ä¸šåŠ¡åŒ…ï¼Œæ’é™¤æ¡†æ¶å’Œå·¥å…·åŒ…
        return packageName.contains("service") ||
               packageName.contains("controller") ||
               packageName.contains("mapper") ||
               packageName.contains("dao")
    }
}
```

---

## ğŸš€ å˜æ›´æ£€æµ‹ä¸è·¯å¾„æ¨è

### å˜æ›´æ£€æµ‹å™¨
```kotlin
class ChangeDetector {
    private val changeListener = object : PsiTreeChangeAdapter() {
        override fun childrenChanged(event: PsiTreeChangeEvent) {
            val changedMethods = extractChangedMethods(event)
            if (changedMethods.size in 2..3) {
                triggerPathAnalysis(changedMethods)
            }
        }
    }
    
    fun extractChangedMethods(event: PsiTreeChangeEvent): List<MethodNode> {
        // ä»å˜æ›´äº‹ä»¶ä¸­æå–æ¶‰åŠçš„æ–¹æ³•èŠ‚ç‚¹
        // è¿”å›æ ¼å¼: com.package.Class#methodName
    }
}
```

### è·¯å¾„æ¨èç®—æ³•
```kotlin
class PathRecommender {
    fun findTopPaths(changedMethods: List<String>): List<CallPath> {
        // 1. æ„å»ºå˜æ›´èŠ‚ç‚¹çš„å­å›¾
        val subGraph = buildSubGraph(changedMethods)
        
        // 2. è®¡ç®—æ‰€æœ‰å¯èƒ½è·¯å¾„
        val allPaths = findAllPaths(changedMethods, maxDepth = 10)
        
        // 3. è·¯å¾„è¯„åˆ†å’Œæ’åº
        val scoredPaths = allPaths.map { path ->
            ScoredPath(path, calculatePathScore(path))
        }.sortedByDescending { it.score }
        
        // 4. è¿”å›å‰3æ¡è·¯å¾„
        return scoredPaths.take(3).map { it.path }
    }
    
    private fun calculatePathScore(path: CallPath): Double {
        var score = 0.0
        
        // è·¯å¾„é•¿åº¦æƒé‡ (è¶ŠçŸ­è¶Šå¥½)
        score += (10.0 - path.length) * 0.3
        
        // è°ƒç”¨ç¡®å®šæ€§æƒé‡
        score += path.edges.map { it.confidence }.average() * 0.4
        
        // ä¸šåŠ¡é‡è¦æ€§æƒé‡ (Controller -> Service -> Mapper æƒé‡é€’å‡)
        score += calculateBusinessWeight(path) * 0.3
        
        return score
    }
}
```

---

## ğŸ¨ UIè®¾è®¡æ–¹æ¡ˆ

### ä¸»ç•Œé¢å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Javaè°ƒç”¨é“¾è·¯åˆ†æ                                    [è®¾ç½®] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š ç´¢å¼•çŠ¶æ€                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ çŠ¶æ€: âœ… å·²å®Œæˆ  â”‚ èŠ‚ç‚¹: 1,234  â”‚ å…³ç³»: 3,456  â”‚ ç”¨æ—¶: 2.3s â”‚ â”‚
â”‚  â”‚ èŒƒå›´: Controller(45) Service(123) Mapper(67)            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ” å˜æ›´åˆ†æ                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æ£€æµ‹åˆ°å˜æ›´:                                              â”‚ â”‚
â”‚  â”‚ â€¢ UserController#getUserInfo (line 45)                  â”‚ â”‚
â”‚  â”‚ â€¢ UserService#getByOpenId (line 23)                     â”‚ â”‚
â”‚  â”‚ â€¢ UserMapper#selectByOpenId (line 12)                   â”‚ â”‚
â”‚  â”‚                                        [åˆ†æè·¯å¾„] [æ¸…é™¤] â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ›¤ï¸ æ¨èè·¯å¾„                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ è·¯å¾„1 (è¯„åˆ†: 8.5) ğŸ¥‡                                     â”‚ â”‚
â”‚  â”‚ UserController#getUserInfo â†’ UserService#getByOpenId    â”‚ â”‚
â”‚  â”‚                           â†’ UserMapper#selectByOpenId   â”‚ â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚  â”‚ è·¯å¾„2 (è¯„åˆ†: 7.2) ğŸ¥ˆ                                     â”‚ â”‚
â”‚  â”‚ UserController#getUserInfo â†’ UserService#validateUser   â”‚ â”‚
â”‚  â”‚                           â†’ UserService#getByOpenId     â”‚ â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚  â”‚ è·¯å¾„3 (è¯„åˆ†: 6.8) ğŸ¥‰                                     â”‚ â”‚
â”‚  â”‚ UserService#getByOpenId â†’ UserMapper#selectByOpenId     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. åˆ†é˜¶æ®µç´¢å¼•
```kotlin
class PhaseIndexer {
    fun indexProject(project: Project) {
        // é˜¶æ®µ1: å¿«é€Ÿæ‰«æï¼Œè¯†åˆ«ç›®æ ‡ç±» (1-2ç§’)
        val targetClasses = quickScanTargetClasses(project)
        updateUI("å‘ç° ${targetClasses.size} ä¸ªç›®æ ‡ç±»")
        
        // é˜¶æ®µ2: è§£ææ–¹æ³•å’ŒåŸºæœ¬è°ƒç”¨å…³ç³» (5-10ç§’)
        val methods = parseMethodsAndCalls(targetClasses)
        updateUI("è§£æ ${methods.size} ä¸ªæ–¹æ³•")
        
        // é˜¶æ®µ3: æ„å»ºæ¥å£å®ç°å…³ç³» (2-5ç§’)
        val implementations = buildImplementationRelations(methods)
        updateUI("æ„å»º ${implementations.size} ä¸ªå®ç°å…³ç³»")
        
        // é˜¶æ®µ4: å†™å…¥Neo4j (3-8ç§’)
        persistToNeo4j(methods, implementations)
        updateUI("ç´¢å¼•å®Œæˆ")
    }
}
```

### 2. å†…å­˜ç®¡ç†
```kotlin
class MemoryOptimizedIndexer {
    private val batchSize = 1000
    private val methodCache = LRUCache<String, MethodNode>(10000)
    
    fun processBatch(methods: List<PsiMethod>) {
        methods.chunked(batchSize).forEach { batch ->
            processBatchInternal(batch)
            System.gc() // å»ºè®®åƒåœ¾å›æ”¶
        }
    }
}
```

### 3. å¢é‡æ›´æ–°
```kotlin
class IncrementalUpdater {
    fun updateChangedFile(file: PsiFile) {
        val affectedMethods = extractMethodsFromFile(file)
        
        // åªæ›´æ–°å˜æ›´çš„æ–¹æ³•åŠå…¶ç›´æ¥å…³ç³»
        affectedMethods.forEach { method ->
            updateMethodInNeo4j(method)
            updateRelatedCalls(method)
        }
    }
}
```

---

## ğŸ”§ æŠ€æœ¯å®ç°è¦ç‚¹

### PSIè§£ææ ¸å¿ƒé€»è¾‘
```kotlin
class TargetClassAnalyzer {
    fun analyzeClass(psiClass: PsiClass): ClassAnalysisResult {
        val blockType = ClassTypeDetector.detectBlockType(psiClass.name!!)
            ?: return ClassAnalysisResult.SKIP
            
        val methods = psiClass.methods
            .filter { it.hasModifierProperty(PsiModifier.PUBLIC) }
            .map { analyzeMethod(it, blockType) }
            
        val calls = methods.flatMap { findMethodCalls(it) }
        
        return ClassAnalysisResult(
            classNode = createClassNode(psiClass, blockType),
            methodNodes = methods,
            callRelations = calls
        )
    }
    
    private fun findMethodCalls(method: PsiMethod): List<CallRelation> {
        val calls = mutableListOf<CallRelation>()
        
        method.accept(object : JavaRecursiveElementVisitor() {
            override fun visitMethodCallExpression(expression: PsiMethodCallExpression) {
                val resolvedMethod = expression.resolveMethod()
                if (resolvedMethod != null && isTargetMethod(resolvedMethod)) {
                    calls.add(createCallRelation(method, resolvedMethod, expression))
                }
                super.visitMethodCallExpression(expression)
            }
        })
        
        return calls
    }
}
```

### Neo4jæ‰¹é‡å†™å…¥ä¼˜åŒ–
```cypher
-- æ‰¹é‡åˆ›å»ºæ–¹æ³•èŠ‚ç‚¹
UNWIND $methods AS method
MERGE (m:Method {id: method.id})
SET m += method.properties

-- æ‰¹é‡åˆ›å»ºè°ƒç”¨å…³ç³»  
UNWIND $calls AS call
MATCH (caller:Method {id: call.callerId})
MATCH (callee:Method {id: call.calleeId})
MERGE (caller)-[r:CALLS]->(callee)
SET r += call.properties
```

---

## ğŸ“ˆ æˆåŠŸæŒ‡æ ‡

### æ€§èƒ½æŒ‡æ ‡
- **ç´¢å¼•é€Ÿåº¦**: 1000ä¸ªæ–¹æ³•/ç§’
- **å†…å­˜å ç”¨**: < 500MB (ä¸­å‹é¡¹ç›®)
- **å“åº”æ—¶é—´**: è·¯å¾„æŸ¥è¯¢ < 100ms
- **å‡†ç¡®ç‡**: è°ƒç”¨å…³ç³»è¯†åˆ« > 95%

### ç”¨æˆ·ä½“éªŒæŒ‡æ ‡  
- **å¯åŠ¨æ—¶é—´**: æ’ä»¶æ¿€æ´» < 3ç§’
- **ç´¢å¼•æ—¶é—´**: ä¸­å‹é¡¹ç›® < 30ç§’
- **UIå“åº”**: æ‰€æœ‰æ“ä½œ < 200ms
- **é”™è¯¯ç‡**: å´©æºƒç‡ < 0.1%

è¿™ä¸ªä¼˜åŒ–æ–¹æ¡ˆä¸“æ³¨äºæ‚¨çš„æ ¸å¿ƒéœ€æ±‚ï¼Œé€šè¿‡èŒƒå›´é™å®šå’Œæ™ºèƒ½ç®—æ³•ï¼Œå®ç°é«˜æ•ˆçš„ä»£ç å˜æ›´åˆ†æå’Œè·¯å¾„æ¨èåŠŸèƒ½ã€‚